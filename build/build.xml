<?xml version="1.0" encoding="UTF-8"?>
<project name="LIB" xmlns:ivy="antlib:org.apache.ivy.ant">
	
	<property file="version.properties" />
	<property file="build.properties" />
	
	<property name="lib" value="../lib" />
	<property name="lib.build" value="${lib}/build" />
	
	<property name="ivy.settings.dir" value="./ivy" />
	<property name="ivy.confs" value="build" />
	
	<property environment="env" />
	<condition property="nexus.user" value="${env.NEXUS_USER}">
		<isset property="env.NEXUS_USER" />
	</condition>
	<condition property="nexus.password" value="${env.NEXUS_PASSWORD}">
		<isset property="env.NEXUS_PASSWORD" />
	</condition>

	<ivy:settings file="${ivy.settings.dir}/ivysettings.xml" />

	<import file="${lib.build}/common_build_webapp.xml" optional="true" />

	<!-- 
	##################################################################################
	##
	## RESOLVE
	##
	##################################################################################
	-->
	<target name="resolve.build">
		<fail unless="nexus.user">Please set ant property 'nexus.user' in your environment settings.</fail>
		<fail unless="nexus.password">Please set ant property 'nexus.password' in your environment settings.</fail>

		<ivy:retrieve pattern="${lib}/[conf]/[artifact].[ext]" conf="build" />
	</target>
	
	<!-- 
	##################################################################################
	##
	## BUILD
	##
	##################################################################################
	-->
	<target name="build.project.infos">
		<tstamp>
			<format property="build.date" pattern="dd.MM.yyyy HH:mm:ss" />
		</tstamp>
    	
    	<copy todir="${out.artifact}">
    		<fileset file="${lib.build}/RELEASE.txt" />
    		<fileset file="${resources.main}/Version.php" />
            <filterchain>
                <filterreader classname="org.apache.tools.ant.filters.ExpandProperties" />
            </filterchain>
    	</copy>

    	<zip destfile="${out.dist}/${release.zip}" update="true">
    		<zipfileset file="${out.artifact}/Version.php" prefix="LIB" />
    		<zipfileset file="${out.artifact}/RELEASE.txt" fullpath="LIB/RELEASE" />
    	</zip>
	</target>

    <target name="build.project">
    	<zip destfile="${out.dist}/${release.zip}">
    		<zipfileset dir="${src.main}" prefix="LIB" />
    	</zip>
	</target>

</project>